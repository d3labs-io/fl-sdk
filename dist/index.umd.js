!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ethers"),require("axios"),require("jsonschema")):"function"==typeof define&&define.amd?define(["exports","ethers","axios","jsonschema"],t):t((e||self).flSdk={},e.ethers,e.axios,e.jsonschema)}(this,function(e,t,r,n){function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=/*#__PURE__*/i(r),o=/*#__PURE__*/function(){function e(e){this.jsonRpcProvider=void 0,this.jsonRpcProvider=e.jsonRpcProvider}var r=e.prototype;return r.createWallet=function(){try{var e=t.ethers.Wallet.createRandom();return Promise.resolve({address:e.address,privateKey:e.privateKey})}catch(e){return Promise.reject(e)}},r.getTransaction=function(e){try{var r=new t.ethers.JsonRpcProvider(this.jsonRpcProvider);return Promise.resolve(r.getTransaction(e))}catch(e){return Promise.reject(e)}},r.getTransactionReceipt=function(e){try{var r=new t.ethers.JsonRpcProvider(this.jsonRpcProvider);return Promise.resolve(r.getTransactionReceipt(e))}catch(e){return Promise.reject(e)}},e}(),a=/*#__PURE__*/function(){function e(e){this.ipfsHttp=void 0,this.ipfsHttp=s.default.create({baseURL:e.ipfsUrl,headers:{Authorization:"Bearer "+e.ipfsToken}})}var t=e.prototype;return t.uploadFile=function(e){try{return Promise.resolve(this.ipfsHttp.postForm("/add",{file:e})).then(function(e){if(e.status>=200&&e.status<300==0)throw new Error("failed, status code: "+e.status+", status text: "+e.statusText);return e.data.cid})}catch(e){return Promise.reject(e)}},t.getFile=function(e){try{return Promise.resolve(this.ipfsHttp.get("/ipfs/"+e,{responseType:"arraybuffer"})).then(function(e){if(e.status>=200&&e.status<300==0)throw new Error("failed to fetch, status code: "+e.status+", message: "+e.statusText);return{fileBuffer:e.data,contentType:e.headers["content-type"]}})}catch(e){return Promise.reject(e)}},e}(),c=[{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"add",type:"address"},{indexed:!1,internalType:"string",name:"symbol",type:"string"}],name:"Created",type:"event"},{inputs:[{internalType:"string",name:"name_",type:"string"},{internalType:"string",name:"symbol_",type:"string"}],name:"create",outputs:[],stateMutability:"nonpayable",type:"function"}],u=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"string",name:"uri",type:"string"}],name:"safeMint",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}],p=/*#__PURE__*/function(){function e(e){this.jsonRpcProvider=void 0,this.nftFactoryAddress=void 0,this.ipfs=void 0,this.jsonRpcProvider=e.jsonRpcProvider,this.nftFactoryAddress=e.nftFactoryAddress,this.ipfs=new a(e)}var r=e.prototype;return r.createSmartContract=function(e,r,n,i){try{var s=new t.ethers.JsonRpcProvider(this.jsonRpcProvider),o=new t.ethers.Wallet(e,s),a=new t.ethers.Contract(this.nftFactoryAddress,c,o);return Promise.resolve(a.create(r,n)).then(function(e){return i?{trxHash:e.hash}:Promise.resolve(e.wait()).then(function(e){return{address:e.logs.find(function(e){return"Created"===e.fragment.name}).args[0],trxHash:e.hash}})})}catch(e){return Promise.reject(e)}},r.mint=function(e,r,n,i){try{var s=new t.ethers.JsonRpcProvider(this.jsonRpcProvider),o=new t.ethers.Wallet(e,s),a=new t.ethers.Contract(r,u,o);return Promise.resolve(a.safeMint(o.getAddress(),n)).then(function(e){return i?{trxHash:e.hash}:Promise.resolve(e.wait()).then(function(t){return{tokenId:t.logs[0].args[2].toString(),trxHash:e.hash}})})}catch(e){return Promise.reject(e)}},r.getTokenURI=function(e,r){try{var n=new t.ethers.JsonRpcProvider(this.jsonRpcProvider),i=new t.ethers.Contract(e,u,n);return Promise.resolve(i.tokenURI(r))}catch(e){return Promise.reject(e)}},r.generateMetadata=function(e){try{var t=function(){var e=Buffer.from(JSON.stringify(n));return Promise.resolve(r.ipfs.uploadFile(e)).then(function(e){return"ipfs://"+e})},r=this,n={name:e.name,description:e.description,timestamp:e.timestamp},i=function(){if(e.file)return Promise.resolve(r.ipfs.uploadFile(e.file)).then(function(e){n.file="ipfs://"+e})}();return Promise.resolve(i&&i.then?i.then(t):t())}catch(e){return Promise.reject(e)}},r.getJSONMetadata=function(e,t){try{var r=this;return Promise.resolve(r.getTokenURI(e,t)).then(function(e){return Promise.resolve(r.ipfs.getFile(e.replace("ipfs://",""))).then(function(e){return e.fileBuffer.toString()})})}catch(e){return Promise.reject(e)}},r.getTokenFile=function(e,t){try{var r=this;return Promise.resolve(r.getJSONMetadata(e,t)).then(function(e){var t=JSON.parse(e);return t.file?Promise.resolve(r.ipfs.getFile(t.file.replace("ipfs://",""))):null})}catch(e){return Promise.reject(e)}},r.checkMetadataSchema=function(e){try{var t=new n.Validator,r=JSON.parse(e);return Promise.resolve(t.validate(r,{title:"Token Metadata",type:"object",properties:{name:{type:"string"},description:{type:"string"},timestamp:{type:"number"},file:{type:"string",optional:!0}},required:["name","description","timestamp"],additionalProperties:!1}).valid)}catch(e){return Promise.reject(e)}},e}();e.SeaseedNFTSdk=function(e){this.nfts=void 0,this.general=void 0,this.ipfs=void 0,this.nfts=new p(e),this.general=new o(e),this.ipfs=new a(e)}});
